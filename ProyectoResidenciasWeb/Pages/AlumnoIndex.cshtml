@page
@model ProyectoResidenciasWeb.Pages.AlumnoIndexModel
@{
}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil del Alumno</title>
    <style>
        .examen {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <h1>Perfil del Alumno</h1>
    <div>
        <h2 id="nombre-alumno"></h2>
        <p>Grado: <span id="grado-alumno"></span></p>
        <p>Sección: <span id="seccion-alumno"></span></p>
    </div>
    <h2>Exámenes</h2>
    <div id="examenes-list"></div>
    <button onclick="window.location.href='login'">Cerrar Sesión</button>

    <script>
     
        document.addEventListener('DOMContentLoaded', async () => {
            const usuarioId = sessionStorage.getItem('usuarioId');
            const nombreUsuario = sessionStorage.getItem('nombreUsuario');
            const tipoUsuario = sessionStorage.getItem('tipoUsuario');
            if (!usuarioId || tipoUsuario !== 'A') {
                // Si no hay usuario autenticado o no es docente, redirigir al login
                window.location.href = 'login';
            }
            const response = await fetch(`https://localhost:7162/api/Alumno/alumno/${usuarioId}`);
            const data = await response.json();

            document.getElementById('nombre-alumno').textContent = data.alumno.nombre;
            document.getElementById('grado-alumno').textContent = data.alumno.grado;
            document.getElementById('seccion-alumno').textContent = data.alumno.seccion;

            const examenesList = document.getElementById('examenes-list');
            data.examenes.forEach(examenData => {
                const examenDiv = document.createElement('div');
                examenDiv.classList.add('examen');

                examenDiv.innerHTML = `
                            <h3>Examen de ${examenData.examen.asignatura || examenData.examen.campoFormativo}</h3>
                            <p>Fecha: ${examenData.examen.fecha}</p>
                            <p>Calificación: ${examenData.calificacion !== null ? examenData.calificacion : 'No calificado'}</p>
                        `;
                examenesList.appendChild(examenDiv);
            });
        });
    </script>
</body>
</html>